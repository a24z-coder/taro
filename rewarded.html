<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É –∏ –ø–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–∫–ª–∞–¥</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://yastatic.net/pcode/adfox/loader.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f8f8f8;
      text-align: center;
    }
    h1 {
      color: #153842;
    }
    #status {
      margin-top: 30px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h1>üéÅ –ü–æ–ª—É—á–∏—Ç–µ –≤–∞—à –¢–∞—Ä–æ-—Ä–∞—Å–∫–ª–∞–¥</h1>
  <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∫–ª–∞–º—É –¥–æ –∫–æ–Ω—Ü–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ä–∞—Å–∫–ª–∞–¥.</p>
  <div id="status">‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∫–ª–∞–º—É...</div>

  <script>
  const prompt = "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∫–∞—Ä—Ç–∞–º –¢–∞—Ä–æ –£—ç–π—Ç–∞. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π: –î—É—Ä–∞–∫ + –ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞ + –°–∏–ª–∞. –î–æ–±–∞–≤—å emoji. –û–ø–∏—à–∏: –æ–±—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –ª—é–±–æ–≤—å, —Ä–∞–±–æ—Ç–∞, –¥–µ–Ω—å–≥–∏, —Å—É–¥—å–±–∞. –†–∞–∑–±–µ–π –ø–æ –∞–±–∑–∞—Ü–∞–º.";

  window.yaContextCb = window.yaContextCb || [];
  window.yaContextCb.push(() => {
    const platform = Ya.Context.AdvManager.getPlatform();

    // –û—Ç–¥–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ –¥–ª—è desktop –∏ touch
    Ya.Context.AdvManager.render({
      blockId: platform === 'desktop' ? 'R-A-4178257-16' : 'R-A-4178257-17',
      type: 'rewarded',
      platform: platform,
      onRewarded: handleRewarded
    });
  });

  async function handleRewarded(isRewarded) {
    const statusEl = document.getElementById("status");

    if (!isRewarded) {
      statusEl.innerText = "‚ùå –í—ã –Ω–µ –¥–æ—Å–º–æ—Ç—Ä–µ–ª–∏ —Ä–µ–∫–ª–∞–º—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.";
      return;
    }

    statusEl.innerText = "üîÆ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–∞—Å–∫–ª–∞–¥...";
    try {
      const res = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer sk-jndRCPQoy8_cQYsT4wU0Sp88GNy1nq0gY8E8WjVKZ9T3BlbkFJTswqa0r5ELGqrr7ArkcfuXq3GP2enm7t8Lgbclb0MA"
        },
        body: JSON.stringify({
          model: "gpt-4o",
          messages: [{ role: "user", content: prompt }],
          max_tokens: 2000
        })
      });

      const data = await res.json();

      if (!res.ok || !data.choices || !data.choices[0]) {
        statusEl.innerText = "‚ùå –û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–∫–ª–∞–¥.";
        console.error("OpenAI API error:", data);
        return;
      }

      const result = data.choices[0].message.content.replace(/###\s?/g, "");
      localStorage.setItem("tarotResult", result);
      window.location.href = "https://–∫–∞—Ä—Ç—ã—Ç–∞—Ä–æ—É—ç–π—Ç–∞.—Ä—Ñ/sochetanie#result";

    } catch (err) {
      statusEl.innerText = "‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–∞—Å–∫–ª–∞–¥–∞.";
      console.error(err);
    }
  }
</script>
